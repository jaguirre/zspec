;; Returns a line profile based on FWHM = line_width (in km/s) gaussians
;; centered at the redshifted freqencies of the hyperfine splittings of
;; the CN 2-1, v = 0 transition, whose amplitudes are chosen based on the
;; integrated intensity parameter from the JPL Line Catalog.  The
;; brightest transition is used as a relative calibrator for the rest of
;; the transitions.  The final result adjusted so that the integrated
;; intensity of the result is equal to the given line_width.  freqs is
;; assumed to be in GHz.  After execution, center is set to the 
;; the freqency of the peak of the line.

FUNCTION make_line_cn2, freqs, redshift, line_width, center
  
;; FROM the JPL Line CATALOG 
;; (first col = Freq, Third col = ALOG10(integrated intensity @ 300K)
;;               26001  CN, v = 0, 1 
;;   224203.8672  0.0351 -8.3810 2 2046.1685  2  260011234 2 1 2 1     1 1 2 1     
;;   224214.9224  0.0347 -8.4788 2 2046.1681  2  260011234 2 1 2 1     1 1 2 2     
;;   224219.3667  0.0356 -8.4745 2 2046.1685  4  260011234 2 1 2 2     1 1 2 1     
;;   224230.3330  0.1000 -8.0967 2 2046.1681  4 -260011234 2 1 2 2     1 1 2 2     
;;   224247.7213  0.0329 -8.4370 2 2046.1675  4  260011234 2 1 2 2     1 1 2 3     
;;   224257.4193  0.0323 -8.4237 2 2046.1681  6  260011234 2 1 2 3     1 1 2 2     
;;   224274.6240  0.1000 -7.7139 2 2046.1675  6 -260011234 2 1 2 3     1 1 2 3     
;;   224528.6916  0.0254 -8.3678 2 2046.1576  2  260011234 2 1 2 1     1 1 1 2     
;;   224544.1920  0.0500 -7.4672 2 2046.1576  4 -260011234 2 1 2 2     1 1 1 2     
;;   224571.1920  0.0500 -6.9431 2 2046.1576  6 -260011234 2 1 2 3     1 1 1 2     
;;   224575.6480  0.0500 -7.4695 2 2046.1561  2 -260011234 2 1 2 1     1 1 1 1     
;;   224591.0970  0.0500 -7.3739 2 2046.1561  4 -260011234 2 1 2 2     1 1 1 1     
;;   224783.6316  0.0142 -6.9371 2 2046.1681  6  260011234 2 1 3 3     1 1 2 2     
;;   224784.0836  0.0134 -6.7371 2 2046.1675  8  260011234 2 1 3 4     1 1 2 3     
;;   224785.3010  0.0500 -7.1625 2 2046.1685  4 -260011234 2 1 3 2     1 1 2 1     
;;   224796.3600  0.0500 -7.6593 2 2046.1681  4 -260011234 2 1 3 2     1 1 2 2     
;;   224800.8960  0.0500 -7.6613 2 2046.1675  6 -260011234 2 1 3 3     1 1 2 3     
;;   224813.7023  0.0231 -9.0428 2 2046.1675  4  260011234 2 1 3 2     1 1 2 3     
;;   226287.4265  0.0279 -4.1215 2    3.7866  2  260011234 2 0 2 1     1 0 2 1     
;;   226298.9240  0.0304 -4.2189 2    3.7863  2  260011234 2 0 2 1     1 0 2 2     
;;   226303.0784  0.0306 -4.2129 2    3.7866  4  260011234 2 0 2 2     1 0 2 1     
;;   226314.5400  0.0500 -3.8372 2    3.7863  4 -260011234 2 0 2 2     1 0 2 2     
;;   226332.5364  0.0206 -4.1747 2    3.7857  4  260011234 2 0 2 2     1 0 2 3     
;;   226341.9306  0.0207 -4.1579 2    3.7863  6  260011234 2 0 2 3     1 0 2 2     
;;   226359.8710  0.0500 -3.4508 2    3.7857  6 -260011234 2 0 2 3     1 0 2 3     
;;   226616.5554  0.0296 -4.1043 2    3.7757  2  260011234 2 0 2 1     1 0 1 2     
;;   226632.1900  0.0500 -3.2044 2    3.7757  4 -260011234 2 0 2 2     1 0 1 2     
;;   226659.5750  0.0500 -2.6815 2    3.7757  6 -260011234 2 0 2 3     1 0 1 2     
;;   226663.7030  0.0500 -3.2072 2    3.7741  2 -260011234 2 0 2 1     1 0 1 1     
;;   226679.3820  0.0500 -3.1122 2    3.7741  4 -260011234 2 0 2 2     1 0 1 1     
;;   226874.1660  0.0500 -2.6749 2    3.7863  6 -260011234 2 0 3 3     1 0 2 2     
;;   226874.7450  0.0500 -2.4751 2    3.7857  8 -260011234 2 0 3 4     1 0 2 3     
;;   226875.8970  0.0500 -2.9004 2    3.7866  4 -260011234 2 0 3 2     1 0 2 1     
;;   226887.3520  0.0500 -3.3979 2    3.7863  4 -260011234 2 0 3 2     1 0 2 2     
;;   226892.1190  0.0500 -3.4004 2    3.7857  6 -260011234 2 0 3 3     1 0 2 3     
;;   226905.3771  0.0242 -4.7824 2    3.7857  4  260011234 2 0 3 2     1 0 2 3     
;;   227191.8386  0.0265 -7.5036 2    3.7757  6  260011234 2 0 3 3     1 0 1 2     

  
  centers = [226287.4265, 226298.9240, 226303.0784, 226314.5400, $
             226332.5364, 226341.9306, 226359.8710, 226616.5554, $
             226632.1900, 226659.5750, 226663.7030, 226679.3820, $
             226874.1660, 226874.7450, 226875.8970, 226887.3520, $
             226892.1190, 226905.3771, 227191.8386]/1000.D
  centers /= (1.0 + redshift)
  
  intens = 10.^[-4.1215, -4.2189, -4.2129, -3.8372, -4.1747, $
                -4.1579, -3.4508, -4.1043, -3.2044, -2.6815, $
                -3.2072, -3.1122, -2.6749, -2.4751, -2.9004, $
                -3.3979, -3.4004, -4.7824, -7.5036]
  intens /= MAX(intens,maxtrans)
  
  c = 299792.458                ; in km/sec
  fwhms = (line_width/c)*centers
  sigmas = fwhms/(2.D*SQRT(2.D*ALOG(2.D)))

  amps = intens/(fwhms/fwhms[maxtrans])
  amps *= (2.D*SQRT(2.D*ALOG(2.D)))/SQRT(2.D*!DPI)

  allline = DBLARR(N_E(freqs))
  totalinten = 0.D
  FOR f = 0L, N_E(centers) - 1 DO $
     allline += amps[f] * EXP(-0.5*((freqs-centers[f])/sigmas[f])^2)

  peak = MAX(allline,peakind)
  center = freqs[peakind]
  RETURN, allline/TOTAL(intens)
END
